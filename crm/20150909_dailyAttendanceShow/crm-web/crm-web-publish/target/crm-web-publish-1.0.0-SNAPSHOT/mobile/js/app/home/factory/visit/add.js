BTR.define(["require","exports","module","../../../base/index","../../../nav/nav","../../../gallery/datepicker/api"],function(e,t,n){var r=e("../../../base/index"),i=r.$,s=e("../../../nav/nav"),o=e("../../../gallery/datepicker/api"),u=new s({prev:{text:'<a href="list.html"><i class="icon iconfont">&#xe61f;</i>拜访信息</a>'},title:"增加拜访信息",op:{id:"J_save",text:"保存"}});u.init(),i(function(){function n(e){i.each(e,function(e,t){t.on("change",function(){i(this).val(i(this).val()+":"+(new Date).getSeconds())})})}function u(){var t=i("#J_bfpl").val(),n=i("#J_ddsj").val(),o=i("#J_bfr").val(),u=i("#J_gtnr").val(),a=i("#J_ldsj").val();if(r.check.null(t)){r.msg.info("拜访频率不能为空啊，亲");return}if(!r.check.isPositiveNum(t)){r.msg.info("拜访频率必须为正整数啊，亲");return}if(r.check.null(n)){r.msg.info("到店时间不能为空啊，亲");return}if(r.check.null(o)||o=="-1"){r.msg.info("拜访人不能为空啊，亲");return}if(o=="0"&&r.check.null(s.val())){r.msg.info("请填写拜访人啊，亲");return}if(r.check.null(u)){r.msg.info("沟通内容不能为空啊，亲");return}if(r.check.null(a)){r.msg.info("离店时间不能为空啊，亲");return}var f={visitFrequency:t,enterTime:n,leaveTime:a,people:o=="0"?s.val():o,content:u,taskID:e};return r.utils.toQueryString(f)}o.init(i);var e=r.data.get("curr_taskid");r.check.null(e)&&r.msg.error("未检测到当前TASKID，请返回！",2e3);var t={theme:"sense-ui",lang:"zh",preset:"datetime",stepMinute:5};i("#J_ddsj").scroller("destroy").scroller(t),i("#J_ldsj").scroller("destroy").scroller(t),n([i("#J_ddsj"),i("#J_ldsj")]);var s=i("#J_bfr_other");i("#J_bfr").on("change",function(){var e=i(this).val();e!="-1"&&(e=="0"?s.show().focus():s.hide())}),i("#J_save").on(r.events.click,function(){var e=u();if(e==undefined)return;i.ajax({url:"/wx/message/createMsgDetail",data:e,type:"POST",success:function(e){r.state.check(e,function(){r.msg.success("拜访信息已保存",2e3,function(){location.href="list.html"})})}})}),r.pageLoaded()})});
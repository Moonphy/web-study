BTR.define(["require","exports","module","../../../base/index","../../../nav/nav","../../../gallery/datepicker/api"],function(e,t,n){var r=e("../../../base/index"),i=r.$,s=e("../../../nav/nav"),o=e("../../../gallery/datepicker/api"),u=new s({prev:{text:'<a href="info-list.html"><i class="icon iconfont">&#xe61f;</i>拜访信息</a>'},title:"添加事故车",op:{id:"J_save",text:"保存"}});u.init(),i(function(){function a(){n.append(e.replace(/\{idx\}/g,u++)),i(".car_"+(u-1)).scroller("destroy").scroller({theme:"sense-ui",lang:"zh",preset:"datetime",stepMinute:5}),f([i(".car_"+(u-1)).eq(u-1)])}function f(e){i.each(e,function(e,t){t.on("change",function(){i(this).val(i(this).val()+":"+(new Date).getSeconds())})})}function l(){var e=i(".list"),t=[];return i.each(e,function(e,n){n=i(n);var s={},o=n.find("input");i.each(o,function(e,t){t=i(t),val=t.val();if(r.check.null(val))return r.msg.info(t.attr("data-tip")),t.focus(),!1;s[t.attr("data-key")]=val});if(c(s)<3)return t=[],!1;t.push(s)}),t}function c(e){var t=typeof e;if(t=="string")return e.length;if(t=="object"){var n=0;for(var r in e)n++;return n}return!1}o.init(i);var e=i("#tpl").text(),t=i("#J_list"),n=i("#J_form"),s=i("#J_add"),u=1;s.on(r.events.click,function(){a()}),a(),i("#J_save").on(r.events.click,function(){var e=l();if(e==undefined||e.length==0)return;var t=JSON.stringify(e);i.ajax({url:"/wx/message/createAccidentCar",type:"POST",data:"taskID="+r.data.get("curr_taskid")+"&accidentCarJSON="+t,success:function(e){r.state.check(e,function(e){r.msg.success("添加成功，感谢使用",2e3,function(){location.href="../visit/list.html"})})}})}),i("#J_form").delegate(".jian",r.events.click,function(e){var t=i(e.target).next(),n=parseInt(t.val())-1;t.val(n<=0?1:n)}),i("#J_form").delegate(".jia",r.events.click,function(e){var t=i(e.target).prev(),n=parseInt(t.val())+1;t.val(n)}).delegate(".num","change",function(e){var t=i(e.target);t.val((t.val()+"").replace(/-/g,""))}),r.pageLoaded()})});
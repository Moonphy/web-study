BTR.define(["require","exports","module","css!./scroller.css"],function(e,t,n){e("css!./scroller.css"),n.exports=function(e){function t(e){if(e.type==="touchstart")a=!0;else if(a)return a=!1,!1;return!0}function n(){u=!0,setTimeout(function(){u=!1},300)}function r(e,t,n){return Math.max(t,Math.min(e,n))}function i(t){var n={values:[],keys:[]};return e.each(t,function(e,t){n.keys.push(e),n.values.push(t)}),n}e.mobiscroll.classes.Scroller=function(a,h){function Nt(e,t,n){e.stopPropagation(),e.preventDefault();if(!j&&!Ct(t)&&!t.hasClass("dwa")){j=!0;var r=t.find(".dw-ul");Lt(r),clearInterval(G),G=setInterval(function(){n(r)},at.delay),n(r)}}function Ct(t){if(e.isArray(at.readonly)){var n=e(".dwwl",C).index(t);return at.readonly[n]}return at.readonly}function kt(t){var n='<div class="dw-bf">',r=pt[t],s=r.values?r:i(r),o=1,u=s.labels||[],a=s.values,f=s.keys||a;return e.each(a,function(e,t){o%20==0&&(n+='</div><div class="dw-bf">'),n+='<div role="option" aria-selected="false" class="dw-li dw-v" data-val="'+f[e]+'"'+(u[e]?' aria-label="'+u[e]+'"':"")+' style="height:'+T+"px;line-height:"+T+'px;"><div class="dw-i">'+t+"</div></div>",o++}),n+="</div>",n}function Lt(t){X=e(".dw-li",t).index(e(".dw-v",t).eq(0)),V=e(".dw-li",t).index(e(".dw-v",t).eq(-1)),Q=e(".dw-ul",C).index(t)}function At(e){var t=at.headerText;return t?typeof t=="function"?t.call(ot,e):t.replace(/\{value\}/i,e):""}function Ot(){st.temp=st.values?st.values.slice(0):at.parseValue(ut.val()||"",st),qt()}function Mt(t){var n=window.getComputedStyle?getComputedStyle(t[0]):t[0].style,r,i;return v?(e.each(["t","webkitT","MozT","OT","msT"],function(e,t){if(n[t+"ransform"]!==undefined)return r=n[t+"ransform"],!1}),r=r.split(")")[0].split(", "),i=r[13]||r[5]):i=n.top.replace("px",""),Math.round(g-i/T)}function _t(e,t){clearTimeout(lt[t]),delete lt[t],e.closest(".dwwl").removeClass("dwa")}function Dt(e,t,n,r,i){var s=(g-n)*T,o=e[0].style,u;if(s==ht[t]&&lt[t])return;r&&s!=ht[t]&&Bt("onAnimStart",[C,t,r]),ht[t]=s,o[d+"Transition"]="all "+(r?r.toFixed(3):0)+"s ease-out",v?o[d+"Transform"]="translate3d(0,"+s+"px,0)":o.top=s+"px",lt[t]&&_t(e,t),r&&i&&(e.closest(".dwwl").addClass("dwa"),lt[t]=setTimeout(function(){_t(e,t)},r*1e3)),ct[t]=n}function Pt(t,n,r){var i=e('.dw-li[data-val="'+t+'"]',n),s=e(".dw-li",n),o=s.index(i),u=s.length;if(!i.hasClass("dw-v")){var a=i,f=i,l=0,c=0;while(o-l>=0&&!a.hasClass("dw-v"))l++,a=s.eq(o-l);while(o+c<u&&!f.hasClass("dw-v"))c++,f=s.eq(o+c);(c<l&&c&&r!==2||!l||o-l<0||r==1)&&f.hasClass("dw-v")?(i=f,o+=c):(i=a,o-=l)}return{cell:i,v:o,val:i.attr("data-val")}}function Ht(t,n,r,i,s){Bt("validate",[C,n,t,i])!==!1&&(e(".dw-ul",C).each(function(r){var o=e(this),u=r==n||n===undefined,a=Pt(st.temp[r],o,i),f=a.cell;if(!f.hasClass("dw-sel")||u)st.temp[r]=a.val,at.multiple||(e(".dw-sel",o).removeAttr("aria-selected"),f.attr("aria-selected","true")),e(".dw-sel",o).removeClass("dw-sel"),f.addClass("dw-sel"),Dt(o,r,a.v,u?t:.1,u?s:!1)}),N=at.formatResult(st.temp),st.live&&qt(r,0,!0),e(".dwv",C).html(At(N)),r&&Bt("onChange",[N]))}function Bt(t,n){var r;return n.push(st),e.each([H,ft,h],function(e,i){i&&i[t]&&(r=i[t].apply(ot,n))}),r}function jt(t,n,i,s,o){n=r(n,X,V);var u=e(".dw-li",t).eq(n),a=o===undefined?n:o,f=o!==undefined,l=Q,c=s?n==a?.1:Math.abs((n-a)*at.timeUnit):0;st.temp[l]=u.attr("data-val"),Dt(t,l,n,c,f),setTimeout(function(){Ht(c,l,!0,i,f)},10)}function Ft(e){var t=ct[Q]+1;jt(e,t>V?X:t,1,!0)}function It(e){var t=ct[Q]-1;jt(e,t<X?V:t,2,!0)}function qt(e,t,n,r,i){mt&&!n&&Ht(t,undefined,i),N=at.formatResult(st.temp),r||(st.values=st.temp.slice(0),st.val=N),e&&vt&&(Z=!0,ut.val(N).change())}function Rt(e,t){var n;tt.on(e,function(e){clearTimeout(n),n=setTimeout(function(){(D&&t||!t)&&st.position(!t)},200)})}var g,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st=this,ot=a,ut=e(ot),at=b({},x),ft={},lt={},ct={},ht={},pt=[],dt=[],vt=ut.is("input"),mt=!1,gt=function(n){t(n)&&!o&&!j&&!it&&!Ct(this)&&(n.preventDefault(),o=!0,I=at.mode!="clickpick",K=e(".dw-ul",this),Lt(K),q=lt[Q]!==undefined,W=q?Mt(K):ct[Q],R=m(n,"Y"),U=new Date,z=R,Dt(K,Q,W,.001),I&&K.closest(".dwwl").addClass("dwa"),e(document).on(E,yt).on(S,bt))},yt=function(e){I&&(e.preventDefault(),e.stopPropagation(),z=m(e,"Y"),Dt(K,Q,r(W+(R-z)/T,X-1,V+1))),R!==z&&(q=!0)},bt=function(t){var n=new Date-U,i=r(W+(R-z)/T,X-1,V+1),s,u,a,f=K.offset().top;n<300?(s=(z-R)/n,u=s*s/at.speedUnit,z-R<0&&(u=-u)):u=z-R,a=Math.round(W-u/T);if(!u&&!q){var l=Math.floor((z-f)/T),c=e(e(".dw-li",K)[l]),h=I;Bt("onValueTap",[c])!==!1?a=l:h=!0,h&&(c.addClass("dw-hl"),setTimeout(function(){c.removeClass("dw-hl")},200))}I&&jt(K,a,0,!0,Math.round(i)),o=!1,K=null,e(document).off(E,yt).off(S,bt)},wt=function(n){it&&it.removeClass("dwb-a"),it=e(this),e(document).on(S,Et),!it.hasClass("dwb-d")&&!it.hasClass("dwb-nhl")&&it.addClass("dwb-a"),it.hasClass("dwwb")&&t(n)&&Nt(n,it.closest(".dwwl"),it.hasClass("dwwbp")?Ft:It)},Et=function(t){j&&(clearInterval(G),j=!1),it&&(it.removeClass("dwb-a"),it=null),e(document).off(S,Et)},St=function(t){t.keyCode==38?Nt(t,e(this),It):t.keyCode==40&&Nt(t,e(this),Ft)},xt=function(e){j&&(clearInterval(G),j=!1)},Tt=function(t){if(!Ct(this)){t.preventDefault(),t=t.originalEvent||t;var n=t.wheelDelta?t.wheelDelta/120:t.detail?-t.detail/3:0,r=e(".dw-ul",this);Lt(r),jt(r,Math.round(ct[Q]-n),n<0?1:2)}};st.position=function(t){if(!J||et||A===k.width()&&O===(tt[0].innerHeight||tt.innerHeight())&&t||Bt("onPosition",[C])===!1)return;var n,i,s,o,u,a,f,l,c,h,p,d,v,m=0,g=0,y=tt.scrollLeft(),b=tt.scrollTop(),w=e(".dwwr",C),E=e(".dw",C),S={},x=at.anchor===undefined?ut:at.anchor;A=k.width(),O=tt[0].innerHeight||tt.innerHeight(),/modal|bubble/.test(at.display)&&(e(".dwc",C).each(function(){n=e(this).outerWidth(!0),m+=n,g=n>g?n:g}),n=m>A?g:m,w.width(n).css("white-space",m>A?"":"nowrap")),M=E.outerWidth(),_=E.outerHeight(!0),D=_<=O&&M<=A,st.scrollLock=D,at.display=="modal"?(i=(A-M)/2,s=b+(O-_)/2):at.display=="bubble"?(v=!0,c=e(".dw-arrw-i",C),a=x.offset(),f=Math.abs(e(at.context).offset().top-a.top),l=Math.abs(e(at.context).offset().left-a.left),o=x.outerWidth(),u=x.outerHeight(),i=r(l-(E.outerWidth(!0)-o)/2-y,3,A-M-3),s=f-_,s<b||f>b+O?(E.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),s=f+u):E.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),h=c.outerWidth(),p=r(l+o/2-(i+(M-h)/2)-y,0,h),e(".dw-arr",C).css({left:p})):(S.width="100%",at.display=="top"?s=b:at.display=="bottom"&&(s=b+O-_)),S.top=s<0?0:s,S.left=i,E.css(S),k.height(0),d=Math.max(s+_,at.context=="body"?e(document).height():nt.scrollHeight),k.css({height:d,left:y}),v&&(s+_>b+O||f>b+O)&&(et=!0,setTimeout(function(){et=!1},300),tt.scrollTop(Math.min(s+_-O,d-O)))},st.enable=function(){at.disabled=!1,vt&&ut.prop("disabled",!1)},st.disable=function(){at.disabled=!0,vt&&ut.prop("disabled",!0)},st.setValue=function(t,n,r,i){st.temp=e.isArray(t)?t.slice(0):at.parseValue.call(ot,t+"",st),qt(n,r,!1,i,n)},st.getValue=function(){return st.values},st.getValues=function(){var e=[],t;for(t in st._selectedValues)e.push(st._selectedValues[t]);return e},st.changeWheel=function(t,n,r){if(C){var i=0,s=t.length;e.each(at.wheels,function(o,u){e.each(u,function(o,u){if(e.inArray(i,t)>-1){pt[i]=u,e(".dw-ul",C).eq(i).html(kt(i)),s--;if(!s)return st.position(),Ht(n,undefined,r),!1}i++});if(!s)return!1})}},st.isVisible=function(){return mt},st.tap=function(e,t){var r,i;at.tap&&e.on("touchstart.dw mousedown.dw",function(e){e.preventDefault(),r=m(e,"X"),i=m(e,"Y")}).on("touchend.dw",function(e){Math.abs(m(e,"X")-r)<20&&Math.abs(m(e,"Y")-i)<20&&t.call(this,e),n()}),e.on("click.dw",function(e){u||t.call(this,e),e.preventDefault()})},st.show=function(t){if(at.disabled||mt)return;at.display=="top"&&(P="slidedown"),at.display=="bottom"&&(P="slideup"),Ot(),Bt("onBeforeShow",[]);var r,i=0,s="";P&&!t&&(s="dw-"+P+" dw-in");var o='<div role="dialog" class="'+at.theme+" dw-"+at.display+(p?" dw"+p.replace(/\-$/,""):"")+(F?"":" dw-nobtn")+'">'+(J?'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+s+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div>':'<div class="dw dwbg dwi">')+'<div class="dwwr"><div aria-live="assertive" class="dwv'+(at.headerText?"":" dw-hidden")+'"></div><div class="dwcc">',u=e.isArray(at.minWidth),a=e.isArray(at.maxWidth),f=e.isArray(at.fixedWidth);e.each(at.wheels,function(t,n){o+='<div class="dwc'+(at.mode!="scroller"?" dwpm":" dwsc")+(at.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>',e.each(n,function(e,t){pt[i]=t,r=t.label!==undefined?t.label:e,o+='<td><div class="dwwl dwrc dwwl'+i+'">'+(at.mode!="scroller"?'<a href="#" tabindex="-1" class="dwb-e dwwb dwwbp" style="height:'+T+"px;line-height:"+T+'px;"><span>+</span></a><a href="#" tabindex="-1" class="dwb-e dwwb dwwbm" style="height:'+T+"px;line-height:"+T+'px;"><span>&ndash;</span></a>':"")+'<div class="dwl">'+r+'</div><div tabindex="0" aria-live="off" aria-label="'+r+'" role="listbox" class="dwww"><div class="dww" style="height:'+at.rows*T+"px;"+(at.fixedWidth?"width:"+(f?at.fixedWidth[i]:at.fixedWidth)+"px;":(at.minWidth?"min-width:"+(u?at.minWidth[i]:at.minWidth)+"px;":"min-width:"+at.width+"px;")+(at.maxWidth?"max-width:"+(a?at.maxWidth[i]:at.maxWidth)+"px;":""))+'"><div class="dw-ul">',o+=kt(i),o+='</div><div class="dwwol"></div></div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>',i++}),o+="</tr></table></div></div>"}),o+="</div>",J&&F&&(o+='<div class="dwbc">',e.each(rt,function(e,t){t=typeof t=="string"?st.buttons[t]:t,o+="<span"+(at.btnWidth?' style="width:'+100/rt.length+'%"':"")+' class="dwbw '+t.css+'"><a href="#" class="dwb dwb'+e+' dwb-e" role="button">'+t.text+"</a></span>"}),o+="</div>"),o+=(J?"</div>":"")+"</div></div></div>",C=e(o),k=e(".dw-persp",C),L=e(".dwo",C),Ht(),Bt("onMarkupReady",[C]),J?(C.appendTo(at.context),P&&!t&&(C.addClass("dw-trans"),setTimeout(function(){C.removeClass("dw-trans").find(".dw").removeClass(s)},350))):ut.is("div")?ut.html(C):C.insertAfter(ut),Bt("onMarkupInserted",[C]),mt=!0,J&&(e(window).on("keydown.dw",function(e){e.keyCode==13?st.select():e.keyCode==27&&st.cancel()}),at.scrollLock&&C.on("touchmove",function(e){D&&e.preventDefault()}),e("input,select,button",nt).each(function(){this.disabled||(e(this).attr("autocomplete")&&e(this).data("autocomplete",e(this).attr("autocomplete")),e(this).addClass("dwtd").prop("disabled",!0).attr("autocomplete","off"))}),st.position(),Rt("orientationchange.dw resize.dw",!1),Rt("scroll.dw",!0)),C.on("DOMMouseScroll mousewheel",".dwwl",Tt).on("keydown",".dwwl",St).on("keyup",".dwwl",xt).on("selectstart mousedown",y).on("click",".dwb-e",y).on("touchend",function(){at.tap&&n()}).on("keydown",".dwb-e",function(t){t.keyCode==32&&(t.preventDefault(),t.stopPropagation(),e(this).click())}),setTimeout(function(){e.each(rt,function(t,n){st.tap(e(".dwb"+t,C),function(e){n=typeof n=="string"?st.buttons[n]:n,n.handler.call(this,e,st)})}),at.closeOnOverlay&&st.tap(L,function(){st.cancel()}),C.on(w,".dwwl",gt).on(w,".dwb-e",wt)},300),Bt("onShow",[C,N])},st.hide=function(t,n,r){if(!mt||!r&&Bt("onClose",[N,n])===!1)return;e(".dwtd",nt).each(function(){e(this).prop("disabled",!1).removeClass("dwtd"),e(this).data("autocomplete")?e(this).attr("autocomplete",e(this).data("autocomplete")):e(this).removeAttr("autocomplete")});if(C){var i=J&&P&&!t;i&&C.addClass("dw-trans").find(".dw").addClass("dw-"+P+" dw-out"),t?C.remove():setTimeout(function(){C.remove(),s&&(f=!0,s.focus())},i?350:1),tt.off(".dw")}ht={},mt=!1},st.select=function(){st.hide(!1,"set")!==!1&&(qt(!0,0,!0),Bt("onSelect",[st.val]))},st.attachShow=function(e,t){dt.push(e),at.display!=="inline"&&e.on((at.showOnFocus?"focus.dw":"")+(at.showOnTap?" click.dw":""),function(n){(n.type!=="focus"||n.type==="focus"&&!f)&&!u&&(t&&t(),s=e,st.show()),setTimeout(function(){f=!1},300)})},st.cancel=function(){st.hide(!1,"cancel")!==!1&&Bt("onCancel",[st.val])},st.init=function(t){H=l.themes[t.theme||at.theme],B=l.i18n[t.lang||at.lang],b(h,t),Bt("onThemeLoad",[B,h]),b(at,H,B,h),at.buttons=at.buttons||["set","cancel"],at.headerText=at.headerText===undefined?at.display!=="inline"?"{value}":!1:at.headerText,st.settings=at,ut.off(".dw");var n=l.presets[at.preset];n&&(ft=n.call(ot,st),b(at,ft,h)),g=Math.floor(at.rows/2),T=at.height,P=at.animate,J=at.display!=="inline",rt=at.buttons,tt=e(at.context=="body"?window:at.context),nt=e(at.context)[0],at.setText||rt.splice(e.inArray("set",rt),1),at.cancelText||rt.splice(e.inArray("cancel",rt),1),at.button3&&rt.splice(e.inArray("set",rt)+1,0,{text:at.button3Text,handler:at.button3}),st.context=tt,st.live=!J||e.inArray("set",rt)==-1,st.buttons.set={text:at.setText,css:"dwb-s",handler:st.select},st.buttons.cancel={text:st.live?at.closeText:at.cancelText,css:"dwb-c",handler:st.cancel},st.buttons.clear={text:at.clearText,css:"dwb-cl",handler:function(){st.trigger("onClear",[C]),ut.val(""),st.live||st.hide()}},F=rt.length>0,mt&&st.hide(!0,!1,!0),J?(Ot(),vt&&(Y===undefined&&(Y=ot.readOnly),ot.readOnly=!0),st.attachShow(ut)):st.show(),vt&&ut.on("change.dw",function(){Z||st.setValue(ut.val(),!1,.2),Z=!1})},st.option=function(e,t){var n={};typeof e=="object"?n=e:n[e]=t,st.init(n)},st.destroy=function(){st.hide(!0,!1,!0),e.each(dt,function(e,t){t.off(".dw")}),e(window).off(".dwa"),vt&&(ot.readOnly=Y),delete c[ot.id],Bt("onDestroy",[])},st.getInst=function(){return st},st.getValidCell=Pt,st.trigger=Bt,c[ot.id]=st,st.values=null,st.val=null,st.temp=null,st.buttons={},st._selectedValues={},st.init(h)};var s,o,u,a,f,l=e.mobiscroll,c=l.instances,h=l.util,p=h.prefix,d=h.jsPrefix,v=h.has3d,m=h.getCoord,g=function(){},y=function(e){e.preventDefault()},b=e.extend,w="touchstart mousedown",E="touchmove mousemove",S="touchend mouseup",x={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,closeOnOverlay:!0,showOnFocus:!0,showOnTap:!0,showLabel:!0,wheels:[],theme:"sense-ui",selectedText:" Selected",closeText:"Close",display:"modal",mode:"scroller",preset:"",lang:"zh",setText:"Set",cancelText:"Cancel",clearText:"Clear",context:"body",scrollLock:!0,tap:!0,btnWidth:!0,speedUnit:.0012,timeUnit:.1,formatResult:function(e){return e.join(" ")},parseValue:function(t,n){var r=t.split(" "),s=[],o=0,u;return e.each(n.settings.wheels,function(t,n){e.each(n,function(t,n){n=n.values?n:i(n),u=n.keys||n.values,e.inArray(r[o],u)!==-1?s.push(r[o]):s.push(u[0]),o++})}),s}};return e(window).on("focus",function(){s&&(f=!0)}),e(document).on("mouseover mouseup mousedown click",function(e){if(u)return e.stopPropagation(),e.preventDefault(),!1}),e.mobiscroll.setDefaults=function(e){b(x,e)},e}});
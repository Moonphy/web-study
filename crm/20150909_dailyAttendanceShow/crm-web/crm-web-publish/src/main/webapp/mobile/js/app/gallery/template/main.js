BTR.define(["require","exports","module"],function(e,t,n){function T(e){return e.replace(b,"").replace(w,",").replace(E,"").replace(S,"").replace(x,"").split(/^$|,+/)}function N(e){return"'"+e.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function C(e,t){function C(e){return a+=e.split(/\n/).length-1,o&&(e=e.replace(/\s+/g," ").replace(/<!--.*?-->/g,"")),e&&(e=c[1]+N(e)+c[2]+"\n"),e}function k(e){var r=a;s?e=s(e,t):n&&(e=e.replace(/\n/g,function(){return a++,"$line="+a+";"}));if(e.indexOf("=")===0){var i=u&&!/^=[=#]/.test(e);e=e.replace(/^=[=#]?|[\s;]*$/g,"");if(i){var o=e.replace(/\s*\([^\)]+\)/,"");!p[o]&&!/^(include|print)$/.test(o)&&(e="$escape("+e+")")}else e="$string("+e+")";e=c[1]+e+c[2]}return n&&(e="$line="+r+";"+e),g(T(e),function(e){if(!e||f[e])return;var t;e==="print"?t=v:e==="include"?t=m:p[e]?t="$utils."+e:d[e]?t="$helpers."+e:t="$data."+e,y+=e+"="+t+",",f[e]=!0}),e+"\n"}var n=t.debug,r=t.openTag,i=t.closeTag,s=t.parser,o=t.compress,u=t.escape,a=1,f={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},l="".trim,c=l?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],h=l?"$out+=text;return $out;":"$out.push(text);",v="function(){var text=''.concat.apply('',arguments);"+h+"}",m="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+h+"}",y="var $utils=this,$helpers=$utils.$helpers,"+(n?"$line=0,":""),b=c[0],w="return new String("+c[3]+");";g(e.split(r),function(e){e=e.split(i);var t=e[0],n=e[1];e.length===1?b+=C(t):(b+=k(t),n&&(b+=C(n)))});var E=y+b+w;n&&(E="try{"+E+"}catch(e){"+"throw {"+"filename:$filename,"+"name:'Render Error',"+"message:e.message,"+"line:$line,"+"source:"+N(e)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')"+"};"+"}");try{var S=new Function("$data","$filename",E);return S.prototype=p,S}catch(x){throw x.temp="function anonymous($data,$filename) {"+E+"}",x}}var r=function(e,t){return typeof t=="string"?m(t,{filename:e}):o(e,t)};r.version="3.0.0",r.config=function(e,t){i[e]=t};var i=r.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},s=r.cache={};r.render=function(e,t){return m(e,t)};var o=r.renderFile=function(e,t){var n=r.get(e)||v({filename:e,name:"Render Error",message:"Template not found"});return t?n(t):n};r.get=function(e){var t;if(s[e])t=s[e];else if(typeof document=="object"){var n=document.getElementById(e);if(n){var r=(n.value||n.innerHTML).replace(/^\s*|\s*$/g,"");t=m(r,{filename:e})}}return t};var u=function(e,t){return typeof e!="string"&&(t=typeof e,t==="number"?e+="":t==="function"?e=u(e.call(e)):e=""),e},a={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},f=function(e){return a[e]},l=function(e){return u(e).replace(/&(?![\w#]+;)|[<>"']/g,f)},c=Array.isArray||function(e){return{}.toString.call(e)==="[object Array]"},h=function(e,t){var n,r;if(c(e))for(n=0,r=e.length;n<r;n++)t.call(e,e[n],n,e);else for(n in e)t.call(e,e[n],n)},p=r.utils={$helpers:{},$include:o,$string:u,$escape:l,$each:h};r.helper=function(e,t){d[e]=t};var d=r.helpers=p.$helpers;r.onerror=function(e){var t="Template Error\n\n";for(var n in e)t+="<"+n+">\n"+e[n]+"\n\n";typeof console=="object"&&console.error(t)};var v=function(e){return r.onerror(e),function(){return"{Template Error}"}},m=r.compile=function(e,t){function a(n){try{return new o(n,r)+""}catch(i){return t.debug?v(i)():(t.debug=!0,m(e,t)(n))}}t=t||{};for(var n in i)t[n]===undefined&&(t[n]=i[n]);var r=t.filename;try{var o=C(e,t)}catch(u){return u.filename=r||"anonymous",u.name="Syntax Error",v(u)}return a.prototype=o.prototype,a.toString=function(){return o.toString()},r&&t.cache&&(s[r]=a),a},g=p.$each,y="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",b=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,w=/[^\w$]+/g,E=new RegExp(["\\b"+y.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),S=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g;i.openTag="{{",i.closeTag="}}";var k=function(e,t){var n=t.split(":"),r=n.shift(),i=n.join(":")||"";return i&&(i=", "+i),"$helpers."+r+"("+e+i+")"};i.parser=function(e,t){e=e.replace(/^\s/,"");var n=e.split(" "),i=n.shift(),s=n.join(" ");switch(i){case"if":e="if("+s+"){";break;case"else":n.shift()==="if"?n=" if("+n.join(" ")+")":n="",e="}else"+n+"{";break;case"/if":e="}";break;case"each":var o=n[0]||"$data",u=n[1]||"as",a=n[2]||"$value",f=n[3]||"$index",l=a+","+f;u!=="as"&&(o="[]"),e="$each("+o+",function("+l+"){";break;case"/each":e="});";break;case"echo":e="print("+s+");";break;case"print":case"include":e=i+"("+n.join(",")+");";break;default:if(s.indexOf("|")!==-1){var c=t.escape;e.indexOf("#")===0&&(e=e.substr(1),c=!1);var h=0,p=e.split("|"),d=p.length,v=c?"$escape":"$string",m=v+"("+p[h++]+")";for(;h<d;h++)m=k(m,p[h]);e="=#"+m}else r.helpers[i]?e="=#"+i+"("+n.join(",")+");":e="="+e}return e},n.exports=r});
BTR.define(["require","exports","module","../../../base/index","../../../nav/nav","../../../gallery/iscroll/api","../../../gallery/template/main","../../../gallery/moment/main","../../../gallery/datepicker/api","../../area/load","../../bill/state","../../../gallery/iscroll/list-api","text!./list-item.tpl"],function(e,t,n){var r=e("../../../base/index"),i=r.$,s=e("../../../nav/nav"),o=e("../../../gallery/iscroll/api"),u=e("../../../gallery/template/main"),a=e("../../../gallery/moment/main"),f=e("../../../gallery/datepicker/api"),l=e("../../area/load"),c=e("../../bill/state"),h=new s({prev:{id:"J_prev",text:'<i class="icon iconfont">&#xe61f;</i>返回'},title:"查看询价及订单"});h.init();var p=e("../../../gallery/iscroll/list-api");i(function(){function s(){return m.template||(m.template=e("text!./list-item.tpl")),m.template}function k(){g.settings.loadFirst=!0,g.loadData()}f.init(i);var t=r.data.get("curr_id"),n=t?"&custID="+t:"",h=i("#J_result_list"),d=i("#J_search_in"),v=i(".icon2"),m={},g=new p({loadDataContainer:h,container:"#J_result_list",url:"/wx/billOfDocument/find/inquirySheetList",buildParam:function(){var e=n;return t||(e+="&provinceID="+(i("#J_sheng").find(".value").find("span").attr("data-id")||"")+"&cityID="+(i("#J_shi").find(".value").find("span").attr("data-id")||"")),"?queryTime="+i.trim(d.val())+e+"&size="+g.size+"&current="+g.current},success:function(e){return r.state.check(e,function(e){if(e){e.model||(e.model=[]),i.each(e.model,function(e,n){if(!t){var r=(n.mfctyName+"").length;n.shotMfctyName=r>10?(n.mfctyName+"").slice(0,10):n.mfctyName}else n.shotMfctyName=a(n.publishTime).format("YYYY-MM-DD");n.state=c.inquiry[n.status]||"未知",n.value=n.brandSystem,n.id=n.inquiryID});var n=u.compile(s());g.appendData(n(e)),i("#wrapper").off(r.events.click,"tr td.item").on(r.events.click,"tr td.item",function(e){location.href="inquiry-detail.html?id="+i(this).parents("tr").attr("id")})}}),e.model},container:"#J_result_list",search:!1,loadedCallback:function(){console.log("数据加载完了"),y.scroll&&y.scroll.refresh()},canDel:!1}),y=new o({id:"#wrapper",pulldownAction:function(){g.refresh()},pullupAction:function(){var e=this;g.loadNext(function(){e.refresh()})}});y.initialize(),g.initialize();var b=i("#J_params"),w=i(".J_params_pannel"),E=i("#J-mask"),S=i(".J_params_trigger");b.on(r.events.click,".J_params_trigger",function(){var e=i(this);e.hasClass("J_t1")?(w.eq(0).show(),w.eq(1).hide()):(w.eq(1).show(),w.eq(0).hide()),S.removeClass("active"),e.addClass("active"),E.show()}),t?(i("#J_params .right").hide(),i("#J_params .line").hide(),i("#J_params .left").css({width:"100%"}),i(".col1").text("日期")):i(".col1").text("厂名"),b.show();var x=i("#J_nav"),T=i(".head");x.on(r.events.click,".J_trigger",function(){var e=i(this);e.hasClass("J_t1")||(location.href="order.html")}),l({},i,r);var N=i("#J_search_in").scroller("destroy").scroller({theme:"sense-ui",lang:"zh",preset:"date",stepMinute:5}),v=i(".icon2"),C=i("#J_search_in");C.on("change",function(){k(),i(this).val()?v.show():v.hide(),w.hide(),E.hide()}),i("#J_qu_id").on("DOMNodeInserted",function(e){var t=i(e.target).text();t!="请选择"&&(k(),w.hide(),E.hide())}),v.on(r.events.click,function(){C.val("").trigger("change")}),i(".J_cancel").on(r.events.click,function(){w.hide(),E.hide()}),i("#J_clear").on(r.events.click,function(){i("#J_sheng").find(".value").find("span").attr("data-id","").text("请选择"),i("#J_shi").find(".value").find("span").attr("data-id","").text("请选择"),i("#J_qu_id").attr("data-id","").text("请选择"),w.hide(),E.hide(),k()}),i("#J_prev").on("click",function(){if(t){var e=r.data.get("curr_factory_url");e?location.href=e:history.back()}else location.href="../../home/my.html"}),h.on(r.events.over,"li.item",function(){i(this).css({background:"#ddd"})}).on(r.events.out,"li.item",function(){i(this).css({background:"#fff"})}),r.pageLoaded()})});
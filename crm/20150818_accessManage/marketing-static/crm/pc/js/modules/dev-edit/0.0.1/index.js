define("modules/dev-edit/0.0.1/index",["common","laydate","layer"],function(require,exports,module){var devEdit={},common=require("common"),$=common.jquery,laydate=require("laydate"),layer=require("layer");$(function(){function getBaseFilterParams(){var t=$(".edit ul li input").serialize();return void 0==t?"":t}function edit(ops){return void 0!=ops?""==$.trim(userId.val())?void(""==$.trim(user.val())?layer.tips("请填写开发人",user,{tips:1}):layer.tips("请使用提示的开发人名称，不能使用提示列表之外的信息",user,{tips:1})):""==$.trim(mainUserId.val())?void(""==$.trim(mainUser.val())?layer.tips("请填写维护人",mainUser,{tips:1}):layer.tips("请使用提示的维护人名称，不能使用提示列表之外的信息",mainUser,{tips:1})):""==$.trim(developTime.val())?void layer.tips("请选择开发时间",developTime,{tips:1}):""==$.trim(maintainTime.val())?void layer.tips("请选择维护时间",maintainTime,{tips:1}):void $.ajax({url:"/base/maintain/update",type:"POST",data:ops,errorMsg:"抱歉，信息更新失败",callback:function(){layer.alert("信息更新成功！",function(){window.location.href=window.location.href})}}):void 0}function listenChange(inputId,changeCallback){function callback(){changeCallback.call(this)}var element=document.getElementById(inputId);element.addEventListener("input",callback,!1)}function loadAccount(){var self=$(this);self.prev("input").val("");var dev="developUser"==self.attr("id")?1:0,key=self.val();$.ajax({url:"/find/byKey",global:!1,data:"key="+encodeURIComponent(key),callback:function(model){$searchResultsList.empty(),model.length>0&&($.each(model,function(idx,data){var li=document.createElement("li");li=$(li).text(data.userName).data("data"+dev,data),$searchResultsList.append(li)}),$searchResults.css({top:self.position().top+36}),$searchResults.show())}})}var user=$("#developUser"),userId=$("#developUserID"),mainUserId=$("#maintainUserID"),mainUser=$("#maintainUser"),developTime=$("#developTime"),maintainTime=$("#maintainTime"),tel=$(".J_tel"),_start={elem:"#developTime",format:"YYYY-MM-DD hh:mm:ss",istime:!0,event:"focus",choose:function(datas){_end.min=datas,_end.start=datas}},_end={elem:"#maintainTime",format:"YYYY-MM-DD hh:mm:ss",event:"focus",istime:!0,choose:function(datas){_start.max=datas}};laydate(_start),laydate(_end),tel.on("mouseover",function(){layer.tips("联系电话不能修改，如需修改，请前往CRM账户管理！",this)}),$("#submitBtn").on("click",function(){var ops=getBaseFilterParams();edit(ops)}),listenChange("developUser",loadAccount),listenChange("maintainUser",loadAccount);var $searchResults=$("#searchResults"),$searchResultsList=$("#searchResults ul");$searchResults.on("click","li",function(){var data=$(this).data("data1"),dev=1;void 0==data&&(dev=0,data=$(this).data("data0")),dev?($("#developUserID").val(data.userID),$("#developUser").val(data.userName),$("#developTel").val(data.mp)):($("#maintainUserID").val(data.userID),$("#maintainUser").val(data.userName),$("#maintainTel").val(data.mp))}),$(document).on("click",function(){$("#searchResults").hide()})}),module.exports=devEdit});
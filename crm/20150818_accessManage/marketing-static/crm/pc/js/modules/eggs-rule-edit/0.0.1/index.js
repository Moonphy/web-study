define("modules/eggs-rule-edit/0.0.1/index",["common","layer","laydate","moment","tpl","modules/eggs-rule-edit/0.0.1/src/list-tpl"],function(require,exports,module){function load(){$.ajax({url:"/hitEgg/find/user/list",data:"current=0&size=1000&orgId="+id,errorMsg:"抱歉，拉取数据失败！",callback:function(data){list.empty(),tpl(listtpl).render(data,function(render){list.append(render.replace(/undefined/g,"").replace(/null/g,""))});var _start;list.find(".time").each(function(idx,time){var self=$(time),id="time"+idx;if(self.attr("id",id),idx%2==0)_start={elem:"#"+id,format:"YYYY-MM-DD hh:mm:ss",event:"focus",istime:!0};else{var _end={elem:"#"+id,format:"YYYY-MM-DD hh:mm:ss",event:"focus",istime:!0,choose:function(datas){_start.max=datas}};_start.choose=function(datas){_end.min=datas,_end.start=datas,$("#"+id).val(moment(datas).add(30,"days").format(dataformat)).removeClass("error")},laydate(_start),laydate(_end),_start={}}})}})}var eggsRuleEdit,common=require("common"),$=common.jquery,layer=require("layer"),laydate=require("laydate"),moment=require("moment"),tpl=require("tpl"),listtpl=require("modules/eggs-rule-edit/0.0.1/src/list-tpl"),list=$("#list"),id=$.utils.getqs("id");if($.isEmpty(id))return void $.keyNotFound();load();var dataformat="YYYY-MM-DD HH:mm:ss";$("#backbtn").on("click",function(){window.history.back()}),$("#list").on("click",".savebtn",function(){var tr=$(this).parents("tr"),uid=tr.data("id"),ratio=tr.find(".ratio"),start=tr.find(".start"),end=tr.find(".end"),ruleLevel=tr.find(".ruleLevel"),max=parseInt(ratio.attr("max")),min=parseInt(ratio.attr("min"));return $.isEmpty(id)?void layer.tips("id丢失！不能提交，请刷新重试",tr):$.isEmpty(ratio.val())?void layer.tips("不能为空",ratio):isNaN(ratio.val())?void layer.tips("请输入"+min+"至"+ratio.attr("max")+"的数字",ratio):ratio.val()>max||ratio.val()<min?void layer.tips("只能输入"+min+"至"+ratio.attr("max")+"之间的数字",ratio):$.isEmpty(start.val())?void layer.tips("不能为空",start):$.isEmpty(end.val())?void layer.tips("不能为空",end):void $.ajax({url:"/hitEgg/edit/user",type:"POST",data:{userId:uid,ratio:ratio.val(),startTime:start.val(),endTime:end.val(),ruleLevel:ruleLevel.val()},errorMsg:"抱歉，保存数据失败，请重试！",callback:function(data){$.alert("已保存！","s",{end:function(){load()}})}})}),module.exports=eggsRuleEdit});
define("modules/cust-search/0.0.1/index",["common","moment","loadcity","pagination","layer","laydate","tpl"],function(require,exports,module){function getBaseFilterParams(){var val=$.trim(mfctyId.val());return val?"mfctyID="+encodeURIComponent(val)+"&"+getDateFilterParams():($.alert("请输入或选择汽修厂再查询！","i"),!1)}function getDateFilterParams(){var datestr="",btn=$(".filter button.active");return datestr=btn.length<=0?$(".filter input").serialize():"start="+startDate.data("date")+"&end="+endDate.data("date"),void 0==datestr?"":datestr}function load(page){page=void 0==page?0:page;var params=getBaseFilterParams();params&&$.ajax({url:"/statisticsTrade/find/statisticsOrderAndReturnForTradeAnalyseByMfctyID",data:encodeURI(params+"&size=10&current="+page),errorMsg:"抱歉，拉取数据失败",callback:function(model){return list.empty(),!model||model.length<=0?void list.empty().append(['<tr class="nodata">','<td colspan="9">没有符合条件的数据</td>',"</tr>"].join("")):void list.append(['<tr class="data" data-mfactyId="',model.mfctyID,'" data-mfactyname="',model.mfctyName,'">',"<td>",model.mfctyName,"</td>","<td>",model.allOrderMoney,"</td>","<td>",model.orderAllNum,"</td>","<td>",model.returnGoodsMenoy||0,"</td>","<td>",model.returnGoodsNum||0,"</td>","<td>",model.orderReturnRatio,"</td>","<td>",model.returnNumToOrderNumRatio,"</td>","</tr>"].join(""))}})}function load2(page,callback){page=void 0==page?0:page,$.ajax({url:"/statisticsTrade/find/statisticsByMfctyID",data:encodeURI(getDateFilterParams()+"&mfctyID="+cache.params.currMfctyId+"&size=10&current="+page),callback:function(model){list2.empty(),tpl(cache.tpl2).render(model,function(render){list2.append(render.replace(/undefined/g,"").replace(/null/g,""))}),pagination.init({target:".pager2",total:model.total,eachCount:model.size,currentPage:model.current,callback:load2}),callback&&callback()}})}function listenChange(inputId,changeCallback){function callback(){changeCallback.call(this)}var element=document.getElementById(inputId);element.addEventListener("input",callback,!1)}function loadAccount(){var self=$(this);self.prev("input").val("");var key=self.val(),top=self.offset().top+36,left=self.offset().left;$.ajax({url:"/statisticsTrade/search/mainMfcty",data:"key="+encodeURIComponent(key),callback:function(model){model.model&&model.model.length>0&&($searchResultsList.empty(),$.each(model.model,function(idx,data){var li=document.createElement("li");li=$(li).text(data.mfctyName).data("data",data),$searchResultsList.append(li)}),$searchResults.css({top:top,left:left}).show())}})}var custSearch,common=require("common"),$=common.jquery,moment=require("moment"),loadcity=require("loadcity"),pagination=require("pagination"),layer=require("layer"),laydate=require("laydate"),tpl=require("tpl"),dataPicker=$(".datepicker"),startDate=$("#startDate"),endDate=$("#endDate"),mfctyName=$("#mfctyName"),mfctyId=$("#mfctyId"),list=$("#list"),list2=$("#list2"),province=($("#list3"),$("#province")),city=$("#city"),area=$("#area"),box=$("#box"),breadcrumb1=($("#box2"),$(".breadcrumb1")),cache=($(".breadcrumb2"),{params:{}}),_start={elem:"#startDate",format:"YYYY-MM-DD",event:"focus",choose:function(datas){_end.min=datas,_end.start=datas}},_end={elem:"#endDate",event:"focus",choose:function(datas){_start.max=datas}};laydate(_start),laydate(_end),$("#query").on("click",function(){load()}),$(".timebtn").on("click","button.item",function(e){var _self=$(this),_siblings=_self.siblings();_self.hasClass("active")?dataPicker.removeAttr("disabled","none"):dataPicker.attr("disabled","disabled"),_siblings.removeClass("active").find(".arrow-up").addClass("fn-hide"),_siblings.find(".arrow-text").addClass("fn-hide"),_self.toggleClass("active").find(".arrow-up").toggleClass("fn-hide"),_self.find(".arrow-text").toggleClass("fn-hide");var day=_self.data("day"),today=moment().format("YYYY-MM-DD"),date=moment().subtract(day,"days").format("YYYY-MM-DD"),yesterday=moment().subtract(1,"days").format("YYYY-MM-DD"),end=day>0?yesterday:today;dataPicker.eq(0).data("date",date),dataPicker.eq(1).data("date",end),$("#startDate").val(date),$("#endDate").val(end)}),$("button.item").eq(0).trigger("click"),province.on("change",function(){var val=province.val();city.find(":not(:first)").remove(),area.find(":not(:first)").remove(),val&&loadcity.loadCity(city,val)}),city.on("change",function(){var val=city.val();val&&(area.find(":not(:first)").remove(),loadcity.loadArea(area,val))}),list.on("click","tr",function(){var _self=$(this);if(!_self.hasClass("nodata")){var mfactyName=_self.data("mfactyname"),mfactyId=_self.data("mfactyid");cache.params.currMfctyId=mfactyId,breadcrumb1.text(mfactyName),require.async("./src/list-tpl2",function(tpl){cache.tpl2=tpl,load2(0,function(){box.show(),cache.d=layer.open({type:1,title:"详细数据",area:"1024px",content:$("#box")})})})}}),loadcity.loadProvince(province);var $searchResults=$("#searchResults"),$searchResultsList=$("#searchResults ul");listenChange("mfctyName",loadAccount),$searchResults.on("click","li",function(){var data=$(this).data("data");data&&(mfctyId.val(data.mfctyID),mfctyName.val(data.mfctyName))}),$(document).on("click",function(e){$("#searchResults").hide()}),module.exports=custSearch});
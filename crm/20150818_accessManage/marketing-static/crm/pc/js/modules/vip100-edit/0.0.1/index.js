define("modules/vip100-edit/0.0.1/index",["common","layer","laydate","moment"],function(require,exports,module){function initalize(){$.ajax({url:"/vip/find/specif",data:"orgID="+id,callback:function(model){keys.forEach(function(key){if("isVip"==key){var vip=model[key];$("#"+key).text(vip?"是":"否")}else if(-1!=key.indexOf("Time")){var end=model[key];"endTime"==key&&update(end),$("#"+key).val(end)}else $("#"+key).text(model[key])})}})}function update(time){var jx=moment(time).diff(moment()),isNumber=0>=jx;!time||isNumber?(isVip.text(isNumber?"是(已过期)":"否"),time?(submitBtn.show(),setVipBtn.hide(),deleteBtn.show()):(setVipBtn.show(),submitBtn.hide(),deleteBtn.hide())):(isVip.text("是(未过期)"),submitBtn.show(),deleteBtn.show(),setVipBtn.hide())}var vip100Edit,common=require("common"),$=common.jquery,layer=require("layer"),laydate=require("laydate"),moment=require("moment"),id=$.utils.getqs("id");if($.isEmpty(id))return void $.keyNotFound();var startTime=$("#startTime"),endTime=$("#endTime"),submitBtn=$("#submitBtn"),deleteBtn=$("#deleteBtn"),setVipBtn=$("#setVipBtn"),isVip=$("#isVip"),_start={elem:"#startTime",format:"YYYY-MM-DD hh:mm:ss",istime:!0,event:"focus",choose:function(datas){_end.min=datas,_end.start=datas}},_end={elem:"#endTime",format:"YYYY-MM-DD hh:mm:ss",event:"focus",istime:!0,choose:function(datas){_start.max=datas}};laydate(_start),laydate(_end),initalize();var keys=["mfctyName","orgID","contactPerson","address","contactMobile","auditTime","isVip","startTime","endTime"];submitBtn.on("click",function(){var start=startTime.val(),end=endTime.val();return $.isEmpty(start)?void layer.tips("生效时间不能为空",startTime):$.isEmpty(end)?void layer.tips("结束时间不能为空",endTime):moment(end).diff(moment(start))<=0?void layer.tips("结束时间不能小于或等于开始时间",endTime):void $.ajax({url:"/vip/edit/specif",type:"POST",data:"orgID="+id+"&startTime="+encodeURIComponent(start)+"&endTime="+encodeURIComponent(end),callback:function(model){$.alert("修改成功！","s"),update(end)}})}),deleteBtn.on("click",function(){layer.confirm("是否确认删除VIP用户？",{icon:3,title:"提示"},function(index){$.ajax({url:"/vip/del/specif",data:"orgID="+encodeURIComponent(id),errorMsg:"抱歉，删除失败！",callback:function(){$.alert("删除成功！","s"),startTime.val(""),endTime.val(""),isVip.text("否"),deleteBtn.hide("fade"),submitBtn.hide("fade"),setVipBtn.show("fade")}})})}),setVipBtn.on("click",function(){var start=startTime.val(),end=endTime.val();return $.isEmpty(start)?void layer.tips("生效时间不能为空",startTime):$.isEmpty(end)?void layer.tips("结束时间不能为空",endTime):void layer.confirm("是否确认设置为VIP用户？",{icon:3,title:"提示"},function(index){$.ajax({url:"/vip/set",type:"POST",data:"orgID="+id+"&startTime="+encodeURIComponent(start)+"&endTime="+encodeURIComponent(end),errorMsg:"抱歉，设置失败！",callback:function(){$.alert("设置成功！","s"),update(end)}})})}),module.exports=vip100Edit});
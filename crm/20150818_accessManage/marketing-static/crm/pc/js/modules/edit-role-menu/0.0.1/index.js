define("modules/edit-role-menu/0.0.1/index",["common","ztree"],function(require,exports,module){function getMenusByRoleId(id,callback){$.ajax({url:"/auth/find/roleHoldResourceList",data:"roleId="+id,errorMsg:"获取岗位现有菜单失败！",callback:function(data){callback.call(this,data)}})}function getAllMenus(callback){$.ajax({url:"/auth/find/resourceTree",errorMsg:"抱歉，拉取菜单树失败！",callback:function(data){callback.call(this,data)}})}var menuEdit,common=require("common"),$=common.jquery,ztree=require("ztree");ztree.loadPlugin("excheck");var id=$.utils.getqs("id");if($.isEmpty(id))return void $.keyNotFound();$("#backBtn").on("click",function(){window.history.back()});var setting={check:{enable:!0,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked",children:"subDTO",name:"resourceName",title:"resourceCode",url:"resourceURL"},simpleData:{enable:!0}}};getAllMenus(function(allmenus){var tree=ztree.init($("#tree"),setting,allmenus.subDTO);tree.expandAll(!0),getMenusByRoleId(id,function(imenus){if(imenus&&imenus.length>0){for(var needchecked=[],i=0;i<imenus.length;i++)needchecked.push(imenus[i].resourceId);for(var nodes=tree.getNodesByFilter(function(node){return 2==node.level&&-1!=needchecked.indexOf(node.resourceId)}),i=0,l=nodes.length;l>i;i++)tree.checkNode(nodes[i],!0,!0,!1)}for(var nodes=tree.getNodesByFilter(function(node){return 1==node.state}),i=0,l=nodes.length;l>i;i++)tree.setChkDisabled(nodes[i],!0)}),$("#submitBtn").on("click",function(){for(var nodes=tree.getNodesByFilter(function(node){return 1==node.checked||1==node.halfCheck}),ids=[],i=0;i<nodes.length;i++){var node=nodes[i];ids.push(node.resourceId)}$.ajax({url:"/auth/update/roleHoldResource",type:"POST",traditional:!0,data:{roleId:id,resourcesJson:JSON.stringify(ids)},errorMsg:"抱歉，菜单分配失败！",callback:function(data){$.alert("菜单信息分配成功！","s")}})})}),module.exports=menuEdit});
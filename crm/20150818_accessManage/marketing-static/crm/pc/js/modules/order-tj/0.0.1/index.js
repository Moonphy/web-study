define("modules/order-tj/0.0.1/index",["common","moment","loadcity","laydate","pagination","tpl","modules/order-tj/0.0.1/src/list-tpl"],function(require,exports,module){function getBaseFilterParams(){var areastr=$(".filter select").serialize();return areastr=void 0==areastr?"":areastr,areastr+"&"+getDateFilterParams()+"&"+getOrderByFilterParams()}function getDateFilterParams(){var datestr="",btn=$(".filter button.active");return datestr=btn.length<=0?$(".filter input").serialize():"start="+startDate.data("date")+"&end="+endDate.data("date"),void 0==datestr?"":datestr}function getOrderByFilterParams(){var sortBy=$('th[scope="sort"].active').data("val")||"";return sortBy}function loadTop(){var keys=["totalOrder","orderNum","totalChargeback","totalChargebackNum"];$.ajax({url:"/statisticsTrade/find/orderAndReturnForYesterdayTradeAnalyse",callback:function(mode){var inner=$("#inner"),numbers=inner.find(".number");$.each(numbers,function(idx,number){1>=idx?$(number).text(mode.statisticsOrderEntity[keys[idx]]):$(number).text(mode.statisticsReturnEntity[keys[idx]])})}})}function load(page){page=void 0==page?0:page,exporting.attr("href","/statisticsTrade/find/orderAndReturnForTradeAnalyseExportExcel?"+encodeURI(getBaseFilterParams())),$.ajax({url:"/statisticsTrade/find/orderAndReturnForTradeAnalyse",data:encodeURI(getBaseFilterParams()+"&size=10&current="+page),errorMsg:"抱歉，拉取数据失败",callback:function(data){(!data.model||data.model.length<=0)&&exporting.hide(),exporting.show(),tpl(listtpl).render(data,function(render){list.empty().append(render.replace(/undefined/g,""))}),pagination.init({target:".pager1",total:data.total,eachCount:data.size,currentPage:data.current,callback:load})}})}function load2(page,callback){page=void 0==page?0:page,exporting_box2.attr("href","/statisticsTrade/find/statisticsOrderAndReturnForTradeAnalyseByCityIDExportExcel?"+encodeURI(getDateFilterParams()+"&cityID="+cache.params.currCityId)),$.ajax({url:"/statisticsTrade/find/statisticsOrderAndReturnForTradeAnalyseByCityID",data:encodeURI(getDateFilterParams()+"&cityID="+cache.params.currCityId+"&size=10&current="+page),callback:function(data){(!data.model||data.model.length<=0)&&exporting_box2.hide(),exporting_box2.show(),tpl(cache.tpl2).render(data,function(render){list2.empty().append(render.replace(/undefined/g,""))}),pagination.init({target:".pager2",total:data.total,eachCount:data.size,currentPage:data.current,callback:load2}),callback&&callback()}})}function load3(page,callback){page=void 0==page?0:page,$.ajax({url:"/statisticsTrade/find/statisticsByMfctyID",data:encodeURI(getDateFilterParams()+"&mfctyID="+cache.params.currMfctyId+"&size=10&current="+page),callback:function(data){tpl(cache.tpl3).render(data,function(render){list3.empty().append(render.replace(/undefined/g,""))}),pagination.init({target:".pager3",total:data.total,eachCount:data.size,currentPage:data.current,callback:load3}),callback&&callback()}})}var order_tj={},common=require("common"),$=common.jquery,layer=$.layer,moment=require("moment"),loadcity=require("loadcity"),laydate=require("laydate"),pagination=require("pagination"),tpl=require("tpl"),listtpl=require("modules/order-tj/0.0.1/src/list-tpl");layer.config({move:!1});var dataPicker=$(".datepicker"),startDate=$("#startDate"),endDate=$("#endDate"),list=$("#list"),list2=$("#list2"),list3=$("#list3"),province=$("#province"),city=$("#city"),area=$("#area"),box2=$("#box2"),box3=$("#box3"),orderCol=$('th[scope="sort"]'),breadcrumb1=($("#orderCol1"),$("#orderCol2"),$("#orderCol3"),$(".breadcrumb1")),breadcrumb2=$(".breadcrumb2"),exporting=$("#exporting"),exporting_box2=$("#exporting_box2"),cache={params:{}},_start={elem:"#startDate",format:"YYYY-MM-DD",event:"focus",choose:function(datas){_end.min=datas,_end.start=datas}},_end={elem:"#endDate",event:"focus",choose:function(datas){_start.max=datas}};laydate(_start),laydate(_end),$("#query").on("click",function(){load()}),orderCol.on("click",function(){var self=$(this),active=self.hasClass("active"),val=self.data("val"),state=self.data("state");orderCol.removeClass("active"),active&&void 0!=state?(self.data("val",val.slice(0,val.length-1)+state),0==state?self.find("b").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):self.find("b").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc"),self.data("state",state?0:1),self.addClass("active")):self.addClass(active?"":"active"),load()}),$(".timebtn").on("click","button.item",function(e){var _self=$(this),_siblings=_self.siblings();_self.hasClass("active")?dataPicker.removeAttr("disabled","none"):dataPicker.attr("disabled","disabled"),_siblings.removeClass("active").find(".arrow-up").addClass("fn-hide"),_siblings.find(".arrow-text").addClass("fn-hide"),_self.toggleClass("active").find(".arrow-up").toggleClass("fn-hide"),_self.find(".arrow-text").toggleClass("fn-hide");var day=_self.data("day"),today=moment().format("YYYY-MM-DD"),date=moment().subtract(day,"days").format("YYYY-MM-DD"),yesterday=moment().subtract(1,"days").format("YYYY-MM-DD"),end=day>0?yesterday:today;dataPicker.eq(0).data("date",date),dataPicker.eq(1).data("date",end),$("#startDate").val(date),$("#endDate").val(end)}),$("button.item").eq(0).trigger("click"),province.on("change",function(){var val=province.val();city.find(":not(:first)").remove(),area.find(":not(:first)").remove(),val&&loadcity.loadCity(city,val)}),city.on("change",function(){var val=city.val();val&&(area.find(":not(:first)").remove(),loadcity.loadArea(area,val))}),list.on("click","tr",function(){var _self=$(this);if(!_self.hasClass("nodata")){var areaId=_self.data("area");if(void 0!=areaId){var areaName=_self.data("areaname");cache.params.currCityId=areaId,cache.params.currCityName=areaName,breadcrumb1.text(areaName),require.async("./src/list-tpl2",function(tpl){cache.tpl2=tpl,load2(0,function(){box2.show(),cache.d2=layer.open({type:1,title:"地区详细数据",area:"1024px",content:$("#box2")})})})}}}),box2.on("click","#list2 tr",function(){var _self=$(this);if(!_self.hasClass("nodata")){var mfactyName=_self.data("mfactyname"),mfactyId=_self.data("mfactyid");cache.params.currMfctyId=mfactyId,breadcrumb2.text(mfactyName),require.async("./src/list-tpl3",function(tpl){cache.tpl3=tpl,load3(0,function(){box3.show(),cache.d3=layer.open({type:1,title:"厂家详细数据",area:"1024px",content:$("#box3")})})})}}),box3.on("click",".breadcrumb1",function(){cache.d3&&layer.close(cache.d3)}),loadTop(),load(),loadcity.loadProvince(province),module.exports=order_tj});
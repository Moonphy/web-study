define("modules/edit-role-user/0.0.1/index",["common","ztree"],function(require,exports,module){function getRolesByUserId(id,callback){$.ajax({url:"/auth/find/userPlayRoleList",data:"userId="+id,errorMsg:"获取用户现有岗位失败！",callback:function(data){callback.call(this,data)}})}function getAllRoles(callback){$.ajax({url:"/auth/find/roleTree",data:"userId="+id,errorMsg:"抱歉，拉取岗位树失败！",callback:function(data){callback.call(this,data)}})}var editRoleUser,common=require("common"),$=common.jquery,ztree=require("ztree");ztree.loadPlugin("excheck");var id=$.utils.getqs("id");if($.isEmpty(id))return void $.keyNotFound();$("#backBtn").on("click",function(){window.history.back()});var setting={check:{enable:!0,chkboxType:{Y:"",N:""}},data:{key:{checked:"checked",children:"subDTO",name:"roleName",title:"roleName",url:""},simpleData:{enable:!0}}};getAllRoles(function(allroles){var tree=ztree.init($("#tree"),setting,allroles.subDTO);tree.expandAll(!0),getRolesByUserId(id,function(iroles){if(iroles&&iroles.length>0){for(var needchecked=[],i=0;i<iroles.length;i++)needchecked.push(iroles[i].roleId);for(var nodes=tree.getNodesByFilter(function(node){return-1!=needchecked.indexOf(node.roleId)}),i=0,l=nodes.length;l>i;i++)tree.checkNode(nodes[i],!0,!0,!1)}for(var nodes=tree.getNodesByFilter(function(node){return 1==node.state}),i=0,l=nodes.length;l>i;i++)tree.setChkDisabled(nodes[i],!0)}),$("#submitBtn").on("click",function(){for(var nodes=tree.getNodesByFilter(function(node){return console.log(node),1==node.checked}),ids=[],i=0;i<nodes.length;i++){var node=nodes[i];ids.push(node.roleId)}$.ajax({url:"/auth/update/userPlayRole",type:"POST",traditional:!0,data:{userId:id,rolesJson:JSON.stringify(ids)},errorMsg:"抱歉，岗位分配失败！",callback:function(data){$.alert("用户岗位分配成功！","s")}})})}),module.exports=editRoleUser});
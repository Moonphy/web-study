define("modules/cust-new/0.0.1/index",["common","moment","laydate","underscore","suggest","tagsinput"],function(require,exports,module){var cust_new={},common=require("common"),$=common.jquery,moment=($.layer,require("moment")),laydate=require("laydate"),_=require("underscore");require("suggest")($),require("tagsinput")($),$(function(){var from=$.utils.getqs("from")||"",cookie=document.cookie.match(/(?:^|;)\s*memot=(\d)/);if("memo"==from){if(!cookie||!cookie[1]){var d=new Date;d.setTime(d.getTime()+2592e6),document.cookie="memot=1; expires="+d.toGMTString()+"; path=/",$.msg("编辑并保存好用户信息，直接关闭本页面（选项卡）即可！")}$("#backbtn").hide()}var mp=$("#mp"),email=$("#email"),mfctyName=$("#mfctyName"),address=$("#address"),cactMan=$("#cactMan"),cactTel=$("#cactTel"),createTime=$("#createTime");$(".autobtn").on("click",function(){var mfctyId=$.trim($("#mfctyId").val());""!=mfctyId&&$.ajax({url:"/customer/orgInfo?mfctyId="+encodeURIComponent(mfctyId),callback:function(model){var need=["loginMobile","loginEmail","orgName","address","contactPerson","contactMobile","createTime"],obj=[mp,email,mfctyName,address,cactMan,cactTel,createTime];$.each(obj,function(idx,o){if(idx==obj.length-1){var date=new Date(model[need[idx]]);model[need[idx]]=moment(date).format("YYYY-MM-DD HH:mm:ss")}o.val(model[need[idx]])})}})});var _start={elem:"#createTime",format:"YYYY-MM-DD hh:mm:ss",event:"focus",istime:!0};laydate(_start),$("#submitBtn").on("click",function(){document.getElementById("form").submit()}),$.ajax({url:"/base/city",errorMsg:"抱歉，拉取城市信息失败",callback:function(citysModel){var citys=new Array;$.each(citysModel,function(idx,model){citys.push(new Array(model.cityCode,model.cityName,model.pingying,model.shouzimu))}),$("#xianxia").tagsInput({defaultText:"输入城市",width:"58%",height:"30px",onChange:function(elem,elem_tags){var all=$("#xianxia").getAllTags();$("#hidden").empty(),$.each(all,function(idx,tag){var obj=_.findWhere(citysModel,{cityName:tag});$("#hidden").append('<input type="checkbox" name="offlines" value="'+obj.cityId+'" checked/>')})}}),$("#xianxia_tag").suggest(citys,{attachObject:"#suggest"});var cityIds=null;$("#id").length>0&&$.ajax({url:"/customer/offlineBuy?custId="+$("#id").val(),type:"GET",async:!1}).success(function(model){if(model&&model.length>0){cityIds=_.pluck(model,"cityId");var needAdd="";$.each(cityIds,function(idx,id){var city=_.findWhere(citysModel,{cityId:id});void 0!=city&&(needAdd+=city.cityName+",")}),$("#xianxia").importTags(needAdd)}})}})}),module.exports=cust_new});
define("gallery/ztree/3.5.18/src/exedit",function(e,t,o){var r=function(e,t){var o={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},r={edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},d=function(e){var t=h.getRoot(e),o=h.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,o.showHoverDom=!0},n=function(e){},a=function(e){var t=e.treeObj,o=E.event;t.bind(o.RENAME,function(t,o,r,d){f.apply(e.callback.onRename,[t,o,r,d])}),t.bind(o.DRAG,function(t,o,r,d){f.apply(e.callback.onDrag,[o,r,d])}),t.bind(o.DRAGMOVE,function(t,o,r,d){f.apply(e.callback.onDragMove,[o,r,d])}),t.bind(o.DROP,function(t,o,r,d,n,a,i){f.apply(e.callback.onDrop,[o,r,d,n,a,i])})},i=function(e){var t=e.treeObj,o=E.event;t.unbind(o.RENAME),t.unbind(o.DRAG),t.unbind(o.DRAGMOVE),t.unbind(o.DROP)},l=function(e){var t=e.target,o=h.getSetting(e.data.treeId),r=e.relatedTarget,d="",n=null,a="",i="",l=null,s=null,c=null;if(f.eqs(e.type,"mouseover")?(c=f.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+E.id.A}]),c&&(d=f.getNodeMainDom(c).id,a="hoverOverNode")):f.eqs(e.type,"mouseout")?(c=f.getMDom(o,r,[{tagName:"a",attrName:"treeNode"+E.id.A}]),c||(d="remove",a="hoverOutNode")):f.eqs(e.type,"mousedown")&&(c=f.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+E.id.A}]),c&&(d=f.getNodeMainDom(c).id,a="mousedownNode")),d.length>0)switch(n=h.getNodeCache(o,d),a){case"mousedownNode":l=v.onMousedownNode;break;case"hoverOverNode":l=v.onHoverOverNode;break;case"hoverOutNode":l=v.onHoverOutNode}var u={stop:!1,node:n,nodeEventType:a,nodeEventCallback:l,treeEventType:i,treeEventCallback:s};return u},s=function(e,t,o,r,d,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)},c=function(e,t){t.cancelEditName=function(e){var t=h.getRoot(this.setting);t.curEditNode&&I.cancelCurEditNode(this.setting,e?e:null,!0)},t.copyNode=function(e,t,o,r){function d(){I.addNodes(n.setting,e,[a],r)}if(!t)return null;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===E.move.TYPE_INNER)return null;var n=this,a=f.clone(t);return e||(e=null,o=E.move.TYPE_INNER),o==E.move.TYPE_INNER?f.canAsync(this.setting,e)?I.asyncNode(this.setting,e,r,d):d():(I.addNodes(this.setting,e.parentNode,[a],r),I.moveNode(this.setting,e,a,o,!1,r)),a},t.editName=function(e){e&&e.tId&&e===h.getNodeCache(this.setting,e.tId)&&(e.parentTId&&I.expandCollapseParentNode(this.setting,e.getParentNode(),!0),I.editNode(this.setting,e))},t.moveNode=function(e,t,o,r){function d(){I.moveNode(n.setting,e,t,o,!1,r)}if(!t)return t;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===E.move.TYPE_INNER)return null;if(e&&(t.parentTId==e.tId&&o==E.move.TYPE_INNER||b(t,this.setting).find("#"+e.tId).length>0))return null;e||(e=null);var n=this;return f.canAsync(this.setting,e)&&o===E.move.TYPE_INNER?I.asyncNode(this.setting,e,r,d):d(),t},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}},u={setSonNodeLevel:function(e,t,o){if(o){var r=e.data.key.children;if(o.level=t?t.level+1:0,o[r])for(var d=0,n=o[r].length;n>d;d++)o[r][d]&&h.setSonNodeLevel(e,o,o[r][d])}}},N={},v={onHoverOverNode:function(e,t){var o=h.getSetting(e.data.treeId),r=h.getRoot(o);r.curHoverNode!=t&&v.onHoverOutNode(e),r.curHoverNode=t,I.addHoverDom(o,t)},onHoverOutNode:function(e,t){var o=h.getSetting(e.data.treeId),r=h.getRoot(o);r.curHoverNode&&!h.isSelectedNode(o,r.curHoverNode)&&(I.removeTreeDom(o,r.curHoverNode),r.curHoverNode=null)},onMousedownNode:function(t,r){function d(t){if(0==c.dragFlag&&Math.abs(A-t.clientX)<s.edit.drag.minMoveSize&&Math.abs(L-t.clientY)<s.edit.drag.minMoveSize)return!0;var r,d,a,i,l,N=s.data.key.children;if(M.css("cursor","pointer"),0==c.dragFlag){if(0==f.apply(s.callback.beforeDrag,[s.treeId,g],!0))return n(t),!0;for(r=0,d=g.length;d>r;r++)0==r&&(c.dragNodeShowBefore=[]),a=g[r],a.isParent&&a.open?(I.expandCollapseNode(s,a,!a.open),c.dragNodeShowBefore[a.tId]=!0):c.dragNodeShowBefore[a.tId]=!1;c.dragFlag=1,u.showHoverDom=!1,f.showIfameMask(s,!0);var v=!0,O=-1;if(g.length>1){var x=g[0].parentTId?g[0].getParentNode()[N]:h.getNodes(s);for(l=[],r=0,d=x.length;d>r;r++)if(void 0!==c.dragNodeShowBefore[x[r].tId]&&(v&&O>-1&&O+1!==r&&(v=!1),l.push(x[r]),O=r),g.length===l.length){g=l;break}}for(v&&(R=g[0].getPreNode(),P=g[g.length-1].getNextNode()),m=b("<ul class='zTreeDragUL'></ul>",s),r=0,d=g.length;d>r;r++)a=g[r],a.editNameFlag=!1,I.selectNode(s,a,r>0),I.removeTreeDom(s,a),r>s.edit.drag.maxShowNodeNum-1||(i=b("<li id='"+a.tId+"_tmp'></li>",s),i.append(b(a,E.id.A,s).clone()),i.css("padding","0"),i.children("#"+a.tId+E.id.A).removeClass(E.node.CURSELECTED),m.append(i),r==s.edit.drag.maxShowNodeNum-1&&(i=b("<li id='"+a.tId+"_moretmp'><a>  ...  </a></li>",s),m.append(i)));m.attr("id",g[0].tId+E.id.UL+"_tmp"),m.addClass(s.treeObj.attr("class")),m.appendTo(M),p=b("<span class='tmpzTreeMove_arrow'></span>",s),p.attr("id","zTreeMove_arrow_tmp"),p.appendTo(M),s.treeObj.trigger(E.event.DRAG,[t,s.treeId,g])}if(1==c.dragFlag){if(T&&p.attr("id")==t.target.id&&k&&t.clientX+w.scrollLeft()+2>e("#"+k+E.id.A,T).offset().left){var j=e("#"+k+E.id.A,T);t.target=j.length>0?j.get(0):t.target}else T&&(T.removeClass(E.node.TMPTARGET_TREE),k&&e("#"+k+E.id.A,T).removeClass(E.node.TMPTARGET_NODE+"_"+E.move.TYPE_PREV).removeClass(E.node.TMPTARGET_NODE+"_"+o.move.TYPE_NEXT).removeClass(E.node.TMPTARGET_NODE+"_"+o.move.TYPE_INNER));T=null,k=null,C=!1,_=s;var z=h.getSettings();for(var B in z)z[B].treeId&&z[B].edit.enable&&z[B].treeId!=s.treeId&&(t.target.id==z[B].treeId||e(t.target).parents("#"+z[B].treeId).length>0)&&(C=!0,_=z[B]);var H=w.scrollTop(),F=w.scrollLeft(),U=_.treeObj.offset(),V=_.treeObj.get(0).scrollHeight,G=_.treeObj.get(0).scrollWidth,X=t.clientY+H-U.top,q=_.treeObj.height()+U.top-t.clientY-H,W=t.clientX+F-U.left,K=_.treeObj.width()+U.left-t.clientX-F,Z=X<s.edit.drag.borderMax&&X>s.edit.drag.borderMin,$=q<s.edit.drag.borderMax&&q>s.edit.drag.borderMin,J=W<s.edit.drag.borderMax&&W>s.edit.drag.borderMin,Q=K<s.edit.drag.borderMax&&K>s.edit.drag.borderMin,ee=X>s.edit.drag.borderMin&&q>s.edit.drag.borderMin&&W>s.edit.drag.borderMin&&K>s.edit.drag.borderMin,te=Z&&_.treeObj.scrollTop()<=0,oe=$&&_.treeObj.scrollTop()+_.treeObj.height()+10>=V,re=J&&_.treeObj.scrollLeft()<=0,de=Q&&_.treeObj.scrollLeft()+_.treeObj.width()+10>=G;if(t.target&&f.isChildOrSelf(t.target,_.treeId)){for(var ne=t.target;ne&&ne.tagName&&!f.eqs(ne.tagName,"li")&&ne.id!=_.treeId;)ne=ne.parentNode;var ae=!0;for(r=0,d=g.length;d>r;r++){if(a=g[r],ne.id===a.tId){ae=!1;break}if(b(a,s).find("#"+ne.id).length>0){ae=!1;break}}ae&&t.target&&f.isChildOrSelf(t.target,ne.id+E.id.A)&&(T=e(ne),k=ne.id)}a=g[0],ee&&f.isChildOrSelf(t.target,_.treeId)&&(!T&&(t.target.id==_.treeId||te||oe||re||de)&&(C||!C&&a.parentTId)&&(T=_.treeObj),Z?_.treeObj.scrollTop(_.treeObj.scrollTop()-10):$&&_.treeObj.scrollTop(_.treeObj.scrollTop()+10),J?_.treeObj.scrollLeft(_.treeObj.scrollLeft()-10):Q&&_.treeObj.scrollLeft(_.treeObj.scrollLeft()+10),T&&T!=_.treeObj&&T.offset().left<_.treeObj.offset().left&&_.treeObj.scrollLeft(_.treeObj.scrollLeft()+T.offset().left-_.treeObj.offset().left)),m.css({top:t.clientY+H+3+"px",left:t.clientX+F+3+"px"});var ie=0,le=0;if(T&&T.attr("id")!=_.treeId){var se=null==k?null:h.getNodeCache(_,k),ce=(t.ctrlKey||t.metaKey)&&s.edit.drag.isMove&&s.edit.drag.isCopy||!s.edit.drag.isMove&&s.edit.drag.isCopy,ue=!(!R||k!==R.tId),Ne=!(!P||k!==P.tId),ve=a.parentTId&&a.parentTId==k,ge=(ce||!Ne)&&f.apply(_.edit.drag.prev,[_.treeId,g,se],!!_.edit.drag.prev),me=(ce||!ue)&&f.apply(_.edit.drag.next,[_.treeId,g,se],!!_.edit.drag.next),pe=(ce||!ve)&&!(_.data.keep.leaf&&!se.isParent)&&f.apply(_.edit.drag.inner,[_.treeId,g,se],!!_.edit.drag.inner);if(ge||me||pe){var Te=e("#"+k+E.id.A,T),fe=se.isLastNode?null:e("#"+se.getNextNode().tId+E.id.A,T.next()),Ee=Te.offset().top,Ie=Te.offset().left,he=ge?pe?.25:me?.5:1:-1,be=me?pe?.75:ge?.5:0:-1,Re=(t.clientY+H-Ee)/Te.height();if((1==he||he>=Re&&Re>=-.2)&&ge?(ie=1-p.width(),le=Ee-p.height()/2,S=E.move.TYPE_PREV):(0==be||Re>=be&&1.2>=Re)&&me?(ie=1-p.width(),le=null==fe||se.isParent&&se.open?Ee+Te.height()-p.height()/2:fe.offset().top-p.height()/2,S=E.move.TYPE_NEXT):(ie=5-p.width(),le=Ee,S=E.move.TYPE_INNER),p.css({display:"block",top:le+"px",left:Ie+ie+"px"}),Te.addClass(E.node.TMPTARGET_NODE+"_"+S),(D!=k||y!=S)&&(Y=(new Date).getTime()),se&&se.isParent&&S==E.move.TYPE_INNER){var Pe=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==se.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===se.tId&&(Pe=!1),Pe&&(window.zTreeMoveTimer=setTimeout(function(){S==E.move.TYPE_INNER&&se&&se.isParent&&!se.open&&(new Date).getTime()-Y>_.edit.drag.autoOpenTime&&f.apply(_.callback.beforeDragOpen,[_.treeId,se],!0)&&(I.switchNode(_,se),_.edit.drag.autoExpandTrigger&&_.treeObj.trigger(E.event.EXPAND,[_.treeId,se]))},_.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=se.tId)}}else T=null,k="",S=E.move.TYPE_INNER,p.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)}else S=E.move.TYPE_INNER,T&&f.apply(_.edit.drag.inner,[_.treeId,g,null],!!_.edit.drag.inner)?T.addClass(E.node.TMPTARGET_TREE):T=null,p.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);D=k,y=S,s.treeObj.trigger(E.event.DRAGMOVE,[t,s.treeId,g])}return!1}function n(t){function r(){if(C){if(!v)for(var e=0,o=g.length;o>e;e++)I.removeNode(s,g[e]);if(S==E.move.TYPE_INNER)I.addNodes(_,R,P);else if(I.addNodes(_,R.getParentNode(),P),S==E.move.TYPE_PREV)for(e=0,o=P.length;o>e;e++)I.moveNode(_,R,P[e],S,!1);else for(e=-1,o=P.length-1;o>e;o--)I.moveNode(_,R,P[o],S,!1)}else if(v&&S==E.move.TYPE_INNER)I.addNodes(_,R,P);else if(v&&I.addNodes(_,R.getParentNode(),P),S!=E.move.TYPE_NEXT)for(e=0,o=P.length;o>e;e++)I.moveNode(_,R,P[e],S,!1);else for(e=-1,o=P.length-1;o>e;o--)I.moveNode(_,R,P[o],S,!1);I.selectNodes(_,P),b(P[0],s).focus().blur(),s.treeObj.trigger(E.event.DROP,[t,_.treeId,P,R,S,v])}if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),D=null,y=null,w.unbind("mousemove",d),w.unbind("mouseup",n),w.unbind("selectstart",a),M.css("cursor","auto"),T&&(T.removeClass(E.node.TMPTARGET_TREE),k&&e("#"+k+E.id.A,T).removeClass(E.node.TMPTARGET_NODE+"_"+E.move.TYPE_PREV).removeClass(E.node.TMPTARGET_NODE+"_"+o.move.TYPE_NEXT).removeClass(E.node.TMPTARGET_NODE+"_"+o.move.TYPE_INNER)),f.showIfameMask(s,!1),u.showHoverDom=!0,0!=c.dragFlag){c.dragFlag=0;var i,l,N;for(i=0,l=g.length;l>i;i++)N=g[i],N.isParent&&c.dragNodeShowBefore[N.tId]&&!N.open&&(I.expandCollapseNode(s,N,!N.open),delete c.dragNodeShowBefore[N.tId]);m&&m.remove(),p&&p.remove();var v=(t.ctrlKey||t.metaKey)&&s.edit.drag.isMove&&s.edit.drag.isCopy||!s.edit.drag.isMove&&s.edit.drag.isCopy;if(!v&&T&&k&&g[0].parentTId&&k==g[0].parentTId&&S==E.move.TYPE_INNER&&(T=null),T){var R=null==k?null:h.getNodeCache(_,k);if(0==f.apply(s.callback.beforeDrop,[_.treeId,g,R,S,v],!0))return void I.selectNodes(O,g);var P=v?f.clone(g):g;S==E.move.TYPE_INNER&&f.canAsync(_,R)?I.asyncNode(_,R,!1,r):r()}else I.selectNodes(O,g),s.treeObj.trigger(E.event.DROP,[t,s.treeId,g,null,null,null])}}function a(){return!1}var i,l,s=h.getSetting(t.data.treeId),c=h.getRoot(s),u=h.getRoots();if(2==t.button||!s.edit.enable||!s.edit.drag.isCopy&&!s.edit.drag.isMove)return!0;var N=t.target,v=h.getRoot(s).curSelectedList,g=[];if(h.isSelectedNode(s,r))for(i=0,l=v.length;l>i;i++){if(v[i].editNameFlag&&f.eqs(N.tagName,"input")&&null!==N.getAttribute("treeNode"+E.id.INPUT))return!0;if(g.push(v[i]),g[0].parentTId!==v[i].parentTId){g=[r];break}}else g=[r];I.editNodeBlur=!0,I.cancelCurEditNode(s);var m,p,T,R,P,w=e(s.treeObj.get(0).ownerDocument),M=e(s.treeObj.get(0).ownerDocument.body),C=!1,_=s,O=s,D=null,y=null,k=null,S=E.move.TYPE_INNER,A=t.clientX,L=t.clientY,Y=(new Date).getTime();return f.uCanDo(s)&&w.bind("mousemove",d),w.bind("mouseup",n),w.bind("selectstart",a),t.preventDefault&&t.preventDefault(),!0}},g={getAbs:function(e){var t=e.getBoundingClientRect(),o=document.body.scrollTop+document.documentElement.scrollTop,r=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+r,t.top+o]},inputFocus:function(e){e.get(0)&&(e.focus(),f.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(e,t){for(var o=h.getRoot(e);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var r=b("iframe",e),d=0,n=r.length;n>d;d++){var a=r.get(d),i=f.getAbs(a),l=b("<div id='zTreeMask_"+d+"' class='zTreeMask' style='top:"+i[1]+"px; left:"+i[0]+"px; width:"+a.offsetWidth+"px; height:"+a.offsetHeight+"px;'></div>",e);l.appendTo(b("body",e)),o.dragMaskList.push(l)}}},m={addEditBtn:function(e,t){if(!(t.editNameFlag||b(t,E.id.EDIT,e).length>0)&&f.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var o=b(t,E.id.A,e),r="<span class='"+E.className.BUTTON+" edit' id='"+t.tId+E.id.EDIT+"' title='"+f.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+E.id.EDIT+" style='display:none;'></span>";o.append(r),b(t,E.id.EDIT,e).bind("click",function(){return f.uCanDo(e)&&0!=f.apply(e.callback.beforeEditName,[e.treeId,t],!0)?(I.editNode(e,t),!1):!1}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||b(t,E.id.REMOVE,e).length>0)&&f.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var o=b(t,E.id.A,e),r="<span class='"+E.className.BUTTON+" remove' id='"+t.tId+E.id.REMOVE+"' title='"+f.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+E.id.REMOVE+" style='display:none;'></span>";o.append(r),b(t,E.id.REMOVE,e).bind("click",function(){return f.uCanDo(e)&&0!=f.apply(e.callback.beforeRemove,[e.treeId,t],!0)?(I.removeNode(e,t),e.treeObj.trigger(E.event.REMOVE,[e.treeId,t]),!1):!1}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){h.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(I.addEditBtn(e,t),I.addRemoveBtn(e,t)),f.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,o){var r=h.getRoot(e),d=e.data.key.name,n=r.curEditNode;if(n){var a=r.curEditInput,i=t?t:o?n[d]:a.val();if(f.apply(e.callback.beforeRename,[e.treeId,n,i,o],!0)===!1)return!1;n[d]=i;var l=b(n,E.id.A,e);l.removeClass(E.node.CURSELECTED_EDIT),a.unbind(),I.setNodeName(e,n),n.editNameFlag=!1,r.curEditNode=null,r.curEditInput=null,I.selectNode(e,n,!1),e.treeObj.trigger(E.event.RENAME,[e.treeId,n,o])}return r.noSelection=!0,!0},editNode:function(e,t){var o=h.getRoot(e);if(I.editNodeBlur=!1,h.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag)return void setTimeout(function(){f.inputFocus(o.curEditInput)},0);var r=e.data.key.name;t.editNameFlag=!0,I.removeTreeDom(e,t),I.cancelCurEditNode(e),I.selectNode(e,t,!1),b(t,E.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+E.id.INPUT+"' treeNode"+E.id.INPUT+" >");var d=b(t,E.id.INPUT,e);d.attr("value",t[r]),e.edit.editNameSelectAll?f.inputSelect(d):f.inputFocus(d),d.bind("blur",function(t){I.editNodeBlur||I.cancelCurEditNode(e)}).bind("keydown",function(t){"13"==t.keyCode?(I.editNodeBlur=!0,I.cancelCurEditNode(e)):"27"==t.keyCode&&I.cancelCurEditNode(e,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),b(t,E.id.A,e).addClass(E.node.CURSELECTED_EDIT),o.curEditInput=d,o.noSelection=!1,o.curEditNode=t},moveNode:function(e,t,o,r,d,n){var a=h.getRoot(e),i=e.data.key.children;if(t!=o&&(!e.data.keep.leaf||!t||t.isParent||r!=E.move.TYPE_INNER)){var l=o.parentTId?o.getParentNode():a,s=null===t||t==a;s&&null===t&&(t=a),s&&(r=E.move.TYPE_INNER);var c=t.parentTId?t.getParentNode():a;r!=E.move.TYPE_PREV&&r!=E.move.TYPE_NEXT&&(r=E.move.TYPE_INNER),r==E.move.TYPE_INNER&&(s?o.parentTId=null:(t.isParent||(t.isParent=!0,t.open=!!t.open,I.setNodeLineIcos(e,t)),o.parentTId=t.tId));var u,N;if(s)u=e.treeObj,N=u;else{if(n||r!=E.move.TYPE_INNER?n||I.expandCollapseNode(e,t.getParentNode(),!0,!1):I.expandCollapseNode(e,t,!0,!1),u=b(t,e),N=b(t,E.id.UL,e),u.get(0)&&!N.get(0)){var v=[];I.makeUlHtml(e,t,v,""),u.append(v.join(""))}N=b(t,E.id.UL,e)}var g=b(o,e);g.get(0)?u.get(0)||g.remove():g=I.appendNodes(e,o.level,[o],null,!1,!0).join(""),N.get(0)&&r==E.move.TYPE_INNER?N.append(g):u.get(0)&&r==E.move.TYPE_PREV?u.before(g):u.get(0)&&r==E.move.TYPE_NEXT&&u.after(g);var m,p,T=-1,f=0,R=null,P=null,w=o.level;if(o.isFirstNode)T=0,l[i].length>1&&(R=l[i][1],R.isFirstNode=!0);else if(o.isLastNode)T=l[i].length-1,R=l[i][T-1],R.isLastNode=!0;else for(m=0,p=l[i].length;p>m;m++)if(l[i][m].tId==o.tId){T=m;break}if(T>=0&&l[i].splice(T,1),r!=E.move.TYPE_INNER)for(m=0,p=c[i].length;p>m;m++)c[i][m].tId==t.tId&&(f=m);if(r==E.move.TYPE_INNER?(t[i]||(t[i]=new Array),t[i].length>0&&(P=t[i][t[i].length-1],P.isLastNode=!1),t[i].splice(t[i].length,0,o),o.isLastNode=!0,o.isFirstNode=1==t[i].length):t.isFirstNode&&r==E.move.TYPE_PREV?(c[i].splice(f,0,o),P=t,P.isFirstNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!0,o.isLastNode=!1):t.isLastNode&&r==E.move.TYPE_NEXT?(c[i].splice(f+1,0,o),P=t,P.isLastNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(r==E.move.TYPE_PREV?c[i].splice(f,0,o):c[i].splice(f+1,0,o),o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!1),h.fixPIdKeyValue(e,o),h.setSonNodeLevel(e,o.getParentNode(),o),I.setNodeLineIcos(e,o),I.repairNodeLevelClass(e,o,w),!e.data.keep.parent&&l[i].length<1){l.isParent=!1,l.open=!1;var M=b(l,E.id.UL,e),C=b(l,E.id.SWITCH,e),_=b(l,E.id.ICON,e);I.replaceSwitchClass(l,C,E.folder.DOCU),I.replaceIcoClass(l,_,E.folder.DOCU),M.css("display","none")}else R&&I.setNodeLineIcos(e,R);P&&I.setNodeLineIcos(e,P),e.check&&e.check.enable&&I.repairChkClass&&(I.repairChkClass(e,l),I.repairParentChkClassWithSelf(e,l),l!=o.parent&&I.repairParentChkClassWithSelf(e,o)),n||I.expandCollapseParentNode(e,o.getParentNode(),!0,d)}},removeEditBtn:function(e,t){b(t,E.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){b(t,E.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,I.removeEditBtn(e,t),I.removeRemoveBtn(e,t),f.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,o){if(o!==t.level){var r=b(t,e),d=b(t,E.id.A,e),n=b(t,E.id.UL,e),a=E.className.LEVEL+o,i=E.className.LEVEL+t.level;r.removeClass(a),r.addClass(i),d.removeClass(a),d.addClass(i),n.removeClass(a),n.addClass(i)}},selectNodes:function(e,t){for(var o=0,r=t.length;r>o;o++)I.selectNode(e,t[o],o>0)}},p={tools:g,view:m,event:N,data:u};e.extend(!0,t.consts,o),e.extend(!0,t._z,p);var T=t,f=T._z.tools,E=T.consts,I=T._z.view,h=T._z.data,b=(T._z.event,f.$);h.exSetting(r),h.addInitBind(a),h.addInitUnBind(i),h.addInitCache(n),h.addInitNode(s),h.addInitProxy(l),h.addInitRoot(d),h.addZTreeTools(c);var R=I.cancelPreSelectedNode;I.cancelPreSelectedNode=function(e,t){for(var o=h.getRoot(e).curSelectedList,r=0,d=o.length;d>r&&(t&&t!==o[r]||(I.removeTreeDom(e,o[r]),!t));r++);R&&R.apply(I,arguments)};var P=I.createNodes;I.createNodes=function(e,t,o,r){P&&P.apply(I,arguments),o&&I.repairParentChkClassWithSelf&&I.repairParentChkClassWithSelf(e,r)};var w=I.makeNodeUrl;I.makeNodeUrl=function(e,t){return e.edit.enable?null:w.apply(I,arguments)};var M=I.removeNode;I.removeNode=function(e,t){var o=h.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),M&&M.apply(I,arguments)};var C=I.selectNode;I.selectNode=function(e,t,o){var r=h.getRoot(e);return h.isSelectedNode(e,t)&&r.curEditNode==t&&t.editNameFlag?!1:(C&&C.apply(I,arguments),I.addHoverDom(e,t),!0)};var _=f.uCanDo;f.uCanDo=function(e,t){var o=h.getRoot(e);return t&&(f.eqs(t.type,"mouseover")||f.eqs(t.type,"mouseout")||f.eqs(t.type,"mousedown")||f.eqs(t.type,"mouseup"))?!0:(o.curEditNode&&(I.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(_?_.apply(I,arguments):!0))}};o.exports={init:r}});
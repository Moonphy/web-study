BTR.define(["require","exports","module","../../base/index","../../nav/nav","../../gallery/datepicker/api"],function(e,t,n){var r=e("../../base/index"),i=r.$,s=e("../../nav/nav"),o=e("../../gallery/datepicker/api"),u=new s({prev:{id:"J_prev",text:'<a href="list.html"><i class="icon iconfont">&#xe61f;</i>任务</a>'},title:"新增任务事项",op:{id:"J_save",text:"保存"}});u.init(),i(function(){function u(e){i.each(e,function(e,t){t.on("change",function(){i(this).val(i(this).val()+":"+(new Date).getSeconds())})})}function a(){var s=i.trim(e.val()),o=i.trim(n.val()),u=t.find(".text").text();if(r.check.null(s)){r.msg.info("请选择时间，亲");return}if(u=="请选择汽修厂"){r.msg.info("请选择汽修厂，亲");return}if(r.check.null(o)){r.msg.info("请输入内容，亲");return}if((o+"").length>200){r.msg.info("内容超过了最大长度200，请尽量精简，亲");return}var a={planTime:s,taskName:o};return r.data.get("curr_factory_ismain")?a.mfctyID=r.data.get("curr_factory_id"):a.custID=r.data.get("curr_factory_custid"),r.utils.toQueryString(a)}o.init(i);var e=i("#J_time"),t=i("#selFactory"),n=i("#J_content"),s=r.utils.mapQuery(window.location.search);s.factory!=undefined&&s.custID!=undefined&&s.id!=undefined&&(t.find("span.text").text(decodeURI(s.factory)),e.val(r.data.get("page_datas_time")),n.val(r.data.get("page_datas_content")),r.data.set("curr_factory_custid",s.custID),r.data.set("curr_factory_id",s.id)),i("#J_time").scroller("destroy").scroller({theme:"sense-ui",lang:"zh",preset:"datetime",stepMinute:5}),u([i("#J_time")]),i("#J_save").on(r.events.click,function(){var e=a();if(e==undefined)return;i.ajax({url:"/wx/task/create/task",data:e,type:"POST",success:function(e){r.state.check(e,function(){r.msg.success("已保存，感谢使用",2e3,function(){location.href="list.html"})})}})}),t.on(r.events.click,function(){r.data.set("page_datas_time",e.val()),r.data.set("page_datas_content",n.val()),location.href="../factory/select2.html"}),r.pageLoaded()})});
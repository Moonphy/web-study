BTR.define(["require","exports","module","../../../base/index","../../../gallery/datepicker/api","../../../gallery/moment/main","../../../gallery/iscroll/api","../../../gallery/template/main","touch","../../../nav/nav","../../../gallery/iscroll/list-api","text!./list-item.tpl"],function(e,t,n){var r=e("../../../base/index"),i=e("../../../gallery/datepicker/api"),s=e("../../../gallery/moment/main"),o=e("../../../gallery/iscroll/api"),u=e("../../../gallery/template/main"),a=r.$;e("touch")(a);var f=e("../../../nav/nav"),l=new f({prev:{text:'<a href="../my.html"><i class="icon iconfont">&#xe61f;</i>我</a>'},title:"备忘录",op:{text:'<a href="add.html"><i class="icon iconfont">&#xe637;</i></a>'}});l.init();var c=e("../../../gallery/iscroll/list-api");a(function(){function t(){return h.template||(h.template=e("text!./list-item.tpl")),h.template}i.init(a);var n=a("#J_result_list"),f=a("#J_search_in"),l=a(".icon2"),h={},p=new c({loadDataContainer:n,container:"#J_result_list",url:"/wx/memorandum/find/memorandumList",buildParam:function(){return"?key="+a.trim(f.val())+"&size="+p.size+"&current="+p.current},success:function(e){return r.state.check(e,function(e){if(e){e.model||(e.model=[]),a.each(e.model,function(e,t){t.time=s(t.planTime).format("HH:mm"),t.date=s(t.planTime).format("YYYY-MM-DD")});var n=u.compile(t());p.appendData(n(e)),r.mobileDevice&&a("#wrapper").off(r.events.click,".item a").on(r.events.click,".item a",function(e){location.href=a(this).attr("href")})}}),e.model},loadedCallback:function(){console.log("数据加载完了"),d.scroll&&d.scroll.refresh(),r.pageLoaded()},canDel:!0,delCallback:function(){var e=a(this).parents("li.item");a.ajax({url:"/wx/memorandum/del",type:"POST",data:"noteID="+e.attr("data-id"),success:function(t){r.state.check(t,function(){e.remove()})}})}});f.scroller("destroy").scroller({preset:"date",stepMinute:5,theme:"sense-ui",lang:"zh"}),f.on("change",function(){p.settings.loadFirst=!0,p.loadData.call(p),a(this).val()?l.show():l.hide()}),l.on(r.events.click,function(e){window._timeStamp&&e.timeStamp-window._timeStamp<50?f.val("").trigger("change"):window._timeStamp=e.timeStamp});var d=new o({id:"#wrapper",pulldownAction:function(){p.refresh()},pullupAction:function(){var e=this;p.loadNext(function(){e.refresh()})}});d.initialize(),p.initialize(),n.on(r.events.over,"li.item",function(){a(this).css({background:"#ddd"})}).on(r.events.out,"li.item",function(){a(this).css({background:"#fff"})}),r.pageLoaded()})});